<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.tnet.dao.BoardDAO">
	
	
	
	
	
	<!-- 마이페이지 본인 게시글 모집중리스트 -->
<!-- 	<select id="getKanbanList" resultType="Board">
		SELECT k.board_id, k.title, ts1.low_name AS give_talent, ts2.low_name AS receive_talent, k.status_code
		FROM board k
		JOIN talent_small ts1 ON k.give_talent = ts1.low_code
		JOIN talent_small ts2 ON k.receive_talent = ts2.low_code
		WHERE k.status_code IN ('SC01', 'SC02', 'SC03')
		AND k.writer_nickname = #{nickname}
	</select> -->
	
	<!-- 게시글 리스트 불러오기 -->
	<select id="selectBoardList" resultType="com.project.tnet.dto.Board">
			select b.*
			from (
			        select rownum nrow, a.*
			        from (
			                select board_id
			                        ,contents
			                        ,city_name
			                        ,district_name
			                        ,ts1.low_name give_talent
			                        , ts2.low_name receive_talent
			                        
			                from board join district using(district_code, city_code) join city using(city_code)
			                        join talent_small ts1 on board.give_talent = ts1.low_code
			                        join talent_small ts2 on board.receive_talent = ts2.low_code
			                       
			                <where>
								  <if test=' city_code != null and city_code != "0" and city_code != ""'>
								    AND city_code = #{city_code}
								  </if>
								  <if test='district_code != null and  district_code != "0" and  district_code != "" '>
								    AND district_code = #{district_code}
								  </if>
								  <if test='low_code != null and  low_code != "0" and  low_code != ""'>
								    AND board.receive_talent = #{low_code}
								  </if>
								  <if test='high_code != null and high_code != "0" and high_code != ""'>
		  						    AND ts2.high_code = #{high_code}
								  </if> 
							 </where>        
			                order by register_date desc
			                ) a
			<![CDATA[            
			        where rownum <= #{endNo}) b
			    where nrow between #{startNo} and #{endNo}
			]]>
	</select>
	
	<select id="getTotalCount" resultType="int">
		select count(*) 
		 from board join district using(district_code,city_code)join city using(city_code)
			                        join talent_small ts1 on board.give_talent=ts1.low_code
			                        join talent_small ts2 on board.receive_talent=ts2.low_code
			                <where>
								  <if test=' city_code != null and city_code != "0" and city_code != ""'>
								    AND city_code = #{city_code}
								  </if>
								  <if test='district_code != null and  district_code != "0" and  district_code != "" '>
								    AND district_code = #{district_code}
								  </if>
								  <if test='low_code != null and  low_code != "0" and  low_code != ""'>
								    AND board.receive_talent = #{low_code}
								  </if>
								  <if test='high_code != null and high_code != "0" and high_code != ""'>
		  						    AND ts2.high_code = #{high_code}
								  </if> 
							 </where>
	</select>
	<!-- 게시글 삭제 -->
	<update id="deleteBoard">
		update board
		set delete_yn='Y'
		where board_id = #{board_id}
	
	</update>
	<!-- 시코드 리스트 -->
	<select id="getCityCodeList" resultType="com.project.tnet.dto.City">
		select * from city
	
	</select>
	<!-- 시에 따른 지역분류 -->
	<select id="getDistrictByCodeList" resultType="com.project.tnet.dto.District">
		select district_code, district_name
		from district
		<if test="city_code != null">
			where city_code = #{city_code}
		</if>
	
	</select>
	<!-- 재능 대분류 가져오기 -->
	<select id="getTalentHighList" resultType="com.project.tnet.dto.TalentHigh">
		select high_code, high_name
		from talent_high
	
	</select>
	<!-- 재능 소분류 찾아오기 -->
	<select id="getTalentSmallList" resultType="com.project.tnet.dto.TalentSmall">
		select low_code, low_name
		from talent_small
		<if test="high_code != null">
			where high_code=#{high_code}
		</if>
	</select>
	
	<select id="getBoard" resultType="com.project.tnet.dto.Board">
			select board_id
			      , title
                  ,contents
                  ,writer_nickname
                  ,read_count
                  ,register_date
                  ,city_name
                  ,district_name
                  ,ts1.low_name give_talent
                  , ts2.low_name receive_talent
                  ,gender
			 from board join district using(district_code,city_code)join city using(city_code)
				                        join talent_small ts1 on board.give_talent=ts1.low_code
				                        join talent_small ts2 on board.receive_talent=ts2.low_code
				                        join member m on board.writer_nickname = m.nickname
			where board_id = #{board_id}
	</select>
	
	<update id="updateReadCount">
		update board
		set read_count = read_count + 1
		where board_id = ${board_id}
	</update>
</mapper>